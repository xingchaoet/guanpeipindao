<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>更多</title>
    <link rel="stylesheet" href="dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="dist/css/left_nav.css">


    <?php $header_css = 'dist/css/header.css' ?>
    <link rel="stylesheet" href="<?php echo $header_css .'?v='. filemtime( $header_css ); ?>">

    <?php $introduce_css = 'dist/css/introduce.css' ?>
    <link rel="stylesheet" href="<?php echo $introduce_css .'?v='. filemtime( $introduce_css ); ?>">

    <?php $progressbar_css = 'dist/css/progressbar.css' ?>
    <link rel="stylesheet" href="<?php echo $progressbar_css .'?v='. filemtime( $progressbar_css ); ?>">

    <style>
        body {
            padding-top: 10px;
            margin-left: 30px;
            margin-right: 30px;
        }

        .col-sm-4 {
            background: #FFF;
            margin-bottom: 10px;
            padding-left: 1px;
            padding-right: 1px;
        }

        .col-sm-9 {
            width: 770px;
        }

        .row {
            margin-bottom: 10px;
        }

        p {
            font-family: 'Microsoft YaHei', 'Arial';
            /*font-size: smaller;*/
            /*ie*/
            /*font-size: xx-small;*/
            font-size: 10px;
            display: block;
            -webkit-margin-before: 0em;
            -webkit-margin-after: 1px;
            -webkit-margin-start: 0px;
            -webkit-margin-end: 0px;
        }

        button {
            font-family: 'Microsoft YaHei', 'Arial';
        }

        .btn-toolbar {
            margin-right: 10px;
            float: right;
        }

        .show_title {
            margin-top: 10px;
            background-color: #EBEBEB;
            /*display: none;*/
            width: 790px;
            height: 32px;
            font-size: 15px;
            line-height: 32px;
            border: 0px solid transparent;
            box-shadow: 0px 1px 3px rgba(34, 25, 25, 0.2);

            background: -moz-linear-gradient(top, #b8c4cb, #f6f6f8); /*火狐*/
            background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#b8c4cb), to(#f6f6f8)); /*谷歌*/
            margin-bottom: 4px;
        }

        .down {
            padding-top: 10px;
            width: 770px;
        }

        .op_batch {
            width: 770px;
            font-family: 'Microsoft YaHei', 'Arial';
            margin-top: -5px;
            font-size: 12px;
        }

        .navbar {
            background-color: lightblue;
        }

        #show_type {
            margin-left: 10px;
            font-family: 'Microsoft YaHei', 'Arial';
            float: left;
        }

        .show_type_style {
            opacity: 0.5;
        }

        .fen_mian {
            /*width: 125px;*/
            /*height: 168px;*/
            width: 150px;
            height: 168px;
        }

        .sum {
            width: 20px;
            height: 15px;
            overflow-x: visible;
            overflow-y: visible;
        }

        .left_td {

        }

        .right_td {
            font-size: 5px;
            width: 115px;
            height: 201px;
        }

        .add_and_check {
            /*margin-left:600px;*/
            /*margin-bottom:40px;*/
            /*float: right;*/
            /*margin-right: 10px;*/
            /*margin-top: 60px;*/
            /*margin-left: 620px;*/
            /*margin-bottom: 20px;*/
            /*position: absolute;*/
        }

        #pagination {

            float: right;
            margin-right: 5px;
        }

        #pagination a {
            text-decoration: none;
        }

        #pagination a:link {
            color: black;
        }

        #pagination a:hover {
            cursor: pointer;
            color: purple;
        }

        #pagination a:visited {
            color: red;
        }

        .need_op_batch {
            margin-top: 10px;
        }

        .batch_ltd {
            margin-top: 5px;
            margin-bottom: 5px;
            width: 260px;
        }

        .batch_mtd {
            margin-top: 5px;
            margin-bottom: 5px;
            width: 260px;
        }

        .batch_r_f_td {
            margin-top: 5px;
            margin-bottom: 5px;
            width: 260px;
            display: none;
        }

        .batch_rtd {
            margin-top: 5px;
            margin-bottom: 5px;
            width: 50px;
        }

        .batch_table {
            margin-bottom: 10px;
            display: none;
        }

        .batch_title {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .batch_icon {
            /*margin-top: 10px;*/
            margin-bottom: 10px;

            float: right;
            margin-right: 10px;
        }

        .default_num_two_types_span {
            display: none;
            height: 25px;
            width: 20px;
        }

        .default_num_two_types_input {
            display: none;
            height: 25px;
            width: 20px;
            text-align: left;

        }

        .hide_before_purchase {
            display: none;
        }

        .hide_before_purchase_session {
            display: none;
        }

        #batch_option {
            margin-top: 5px;
            float: left;
        }

        .flow {
            margin-top: 5px;
            margin-left: 5px;
            float: left;
            display: none;
        }

        .clear{
            clear: both;
        }

    </style>
</head>
<body>

{include file="header.html"}
<div class="site">
    <a id="default_num_two_types" style="display: none ">{if $smarty.session.default_num_two_types}{$smarty.session.default_num_two_types}{else}2{/if}</a>
    <div class="row ">

        <div class="col-sm-3">
            <!--<img src="../dist/js/holder.js/263x800" alt="">-->
            {include file="left_nav.html"}

            <div class="introduce">
                {$introduce}
            </div>

        </div>
        <div class="col-sm-9">

            <div class="op_batch">
                <div class="need_op_batch">

                    <div class="batch_title">
            <span>
            你还有{$need_op_batch_num}条未处理批次
            </span>
                        <span class="batch_icon">
            <img id="toggle_table" src="{$relpostodist}dist/picture/chachong/hide_table.png">
            </span>
                    </div>

                    <table id="batch_table" class="batch_table">
                        <tr>
                            <td align="center" class="batch_ltd">
                                批次号
                            </td>

                            <td class="batch_mtd">
                                批次产生时间
                            </td>

                            <td class="batch_r_f_td">
                                添加到此批次
                            </td>

                            <td class="batch_rtd">
                                删除
                            </td>

                        </tr>
                        {foreach $need_op_batch_detail as $val }
                        <tr>
                            <td class="batch_ltd">
                                <a class="batch_item">{$val['PiCi_Num']}</a>
                            </td>

                            <td class="batch_mtd">
                                {$val['Date_Time']}
                            </td>

                            <td class="batch_r_f_td">
                                <input id='' type="radio" name="add_to_batch" value=""/>
                            </td>

                            <td class="batch_rtd">
                                <a class="delete_batch"><img width="19" height="19"
                                                             src="{$relpostodist}dist/picture/chachong/delete_batch.png"></a>
                            </td>

                        </tr>
                        {/foreach}
                    </table>

                </div>
            </div>

            <div class="show_title">
                <div id="show_type">
                    <h4><b>{$sub_title}</b></h4>
                </div>
                <div class="btn-toolbar">
                    <div class="show_type_style ">
                        <label class="">显示方式：</label>
                        <a><img id="list" src="{$relpostodist}dist/picture/pic_list/list_enable.gif"></a>
                        <!--<img id="list" src="{$relpostodist}dist/picture/pic_list/list_disable.gif">-->
                        <!--<a href="more.php?type=recommend&show=list" class='btn btn-info'>列表</a>-->
                        <a><img id="picture" src="{$relpostodist}dist/picture/pic_list/pic_disable.gif"></a>
                        <!--<img id="picture" src="{$relpostodist}dist/picture/pic_list/pic_enable.gif">-->
                    </div>
                    </p>
                </div>
            </div>

            <div class="wrap_add_and_check">

                {if $smarty.session.start_purchase_two_types}

                <div id='batch_option'>
                    <input id='batch_option_create_radio' type="radio" name="batch_option_radio" value="创建新批次"/>创建新批次
                    <input id='batch_option_add_radio' type="radio" name="batch_option_radio" value="添加到原有批次"/>添加到原有批次

                    <span class='default_num_two_types_span'>默认数量</span> <input class=' default_num_two_types_input'
                                                                                type='text'>

                </div>
                <div class='flow'>
                    <button id='manipulate_session_two_types_btn' class='btn btn-default btn-sm' style='float: left'
                            disabled='true' onclick='manipulate_session_two_types();'>开始采购
                    </button>

                </div>
                <div id='progressbar' style='float: left'>
                    <div></div>
                </div>

                {else}

                <div id='batch_option'>
                    <input id='batch_option_create_radio' type="radio" name="batch_option_radio" value="创建新批次"/>创建新批次
                    <input id='batch_option_add_radio' type="radio" name="batch_option_radio" value="添加到原有批次"/>添加到原有批次

                    <span class='default_num_two_types_span'>默认数量</span> <input class=' default_num_two_types_input'
                                                                                type='text'>

                </div>
                <div class='flow'>
                    <button id='manipulate_session_two_types_btn' class='btn btn-default btn-sm' style='float: left'
                            disabled='true' onclick='manipulate_session_two_types();'>开始采购
                    </button>

                </div>
                <div id='progressbar' style='float: left'>
                    <div></div>
                </div>

                {/if}

            </div>

            <div class="clear"></div>

            <div id="down" class="down">
                <div id="div_list" name="div_list">

                    <!--<div>-->
                    <!--<input type="checkbox"  id="checkall_box" onclick='checkallbox_changed();'-->
                    <!--name="all" class="checkall_box">-->
                    <!--<label>全选</label>-->
                    <!--</div>-->

                    {if $smarty.session.first_search_two_types}
                    <div class='hide_before_purchase'>
                        <input type="checkbox" id="checkall_box" onclick='checkallbox_changed();'
                               name="all" class="checkall_box">
                        <label>全选</label>
                    </div>
                    {elseif $smarty.session.start_purchase_two_types}

                    <div class=''>
                        <input type="checkbox" id="checkall_box" onclick='checkallbox_changed();'
                               name="all" class="checkall_box">
                        <label>全选</label>

                    </div>
                    {else}

                    <div class='hide_before_purchase_session'>
                        <input type="checkbox" id="checkall_box" onclick='checkallbox_changed();'
                               name="all" class="checkall_box">
                        <label>全选</label>
                    </div>
                    {/if}

                    <div class="row">
                        {foreach $books as $val }
                        <div class="col-sm-4">
                            <table id="table">
                                <tr>
                                    <td class="left_td">
                                        <!--<a href="detail.php?book_id={$val['book_id']}"><img-->

                                        {if trim($val['slt'])}
                                        <a href="detail.php?book_id={$val['book_id']}"><img
                                                src="http://www.ecsponline.com/{trim($val['slt'])}"
                                                class="fen_mian"
                                                onerror="javascript:this.src='dist/images/nopicture.png';"
                                                alt=""></a>
                                        {else}
                                        <a href="detail.php?book_id={$val['book_id']}"><img
                                                src="dist/images/nopicture.png"
                                                class="fen_mian" alt=""></a>
                                        {/if}


                                    </td>
                                    <td class="right_td">

                                        {if $smarty.session.first_search_two_types}

                                        <input type="checkbox"
                                               name="{$val['book_id']}"
                                               class="checkall get_book_info_and_update_db_class hide_before_purchase"/>
                                        <p class="hide_before_purchase">数量：
                                            <input type="text" name="{$val['book_id']}"
                                                   id="sum_{$val['book_id']}"
                                                   class="sum get_book_num_and_update_db_class hide_before_purchase"
                                                   onmouseover='num_limit();'
                                                   value="{$smarty.session.default_num_two_types}"/>
                                        </p>

                                        {elseif $smarty.session.start_purchase_two_types}

                                        <input type="checkbox"
                                               name="{$val['book_id']}"
                                               class="checkall get_book_info_and_update_db_class"/>
                                        <p>数量：
                                            <input type="text" name="{$val['book_id']}"
                                                   id="sum_{$val['book_id']}"
                                                   class="get_book_num_and_update_db_class"
                                                   onmouseover='num_limit();'
                                                   value="{$smarty.session.default_num_two_types}"/>
                                        </p>

                                        {else}


                                        <input type="checkbox"
                                               name="{$val['book_id']}"
                                               class="checkall get_book_info_and_update_db_class hide_before_purchase_session"/>
                                        <p class="hide_before_purchase">数量：
                                            <input type="text" name="{$val['book_id']}"
                                                   id="sum_{$val['book_id']}"
                                                   class="get_book_num_and_update_db_class hide_before_purchase_session"
                                                   onmouseover='num_limit();'
                                                   value="{$smarty.session.default_num_two_types}"/>
                                        </p>

                                        {/if}


                                        <div class="tooltip-demo">
                                            <p data-toggle="tooltip" title="{$val['sm']}">书名：
                                                {$val['sm']|truncate:5:"...":true}</p>
                                        </div>
                                        <p>ISBN: {$val['isbn']}</p>

                                        <div class="tooltip-demo">
                                            <p data-toggle="tooltip" title="{$val['zzh']}">作者：
                                                {$val['zzh']|truncate:5:"...":true}</p>
                                        </div>
                                        <p>出版日期: {$val['cbrq']}</p>
                                        <p>价格: ￥{$val['dj']|string_format:"%.2f"}</p>
                                        <p>库存:{$val['kucun']}</p>

                                    </td>
                                </tr>
                            </table>
                        </div>
                        {/foreach}
                    </div>
                    {$page->show()}
                </div>
            </div>
        </div>
    </div>
</div>


<a id="booktype" style="display: none ">{$type}</a>
<a id="page_num" style="display: none ">{$page_num}</a>

</body>
<script src="dist/js/jquery.min.js"></script>
<script src="dist/js/bootstrap.min.js"></script>
<!--<script src="dist/js/holder.min.js"></script>-->
<script src="dist/js/application.js"></script>

<script src="dist/js/zzsc.js"></script>
<script src="dist/js/left_nav.js"></script>

<?php $morebooks_js = 'dist/js/morebooks.js' ;?>
<script src='dist/js/morebooks.js?v=<?php echo filemtime( $morebooks_js );?>'></script>

<!--<script src="dist/js/morebooks.js?+Math.random()"></script>-->
<script>

    $("#list").click(function () {

                path = "{$relpostodist}dist/picture/pic_list/list_disable.gif";
                path2 = "{$relpostodist}dist/picture/pic_list/pic_enable.gif";


                if ($("#list").attr('src') == path) {
                    return;
                }
                var fdata = new FormData();
//推荐还是最新
                var booktype = $("#booktype").text();
                fdata.append("type", booktype);

                var page_num = $("#page_num").text();
                fdata.append("page", page_num);

                fdata.append("show", 'list');

                xhr.open('POST', more_url, true);

                xhr.send(fdata);
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4) {
                        $("#list").attr('src', path);
                        $("#picture").attr('src', path2);
                        document.getElementById('down').innerHTML = '';
                        document.getElementById('down').innerHTML = this.responseText;
                    }
                }
            }
    );

    $("#picture").click(function () {

                path = "{$relpostodist}dist/picture/pic_list/pic_disable.gif";
                path2 = "{$relpostodist}dist/picture/pic_list/list_enable.gif";

                if ($("#picture").attr('src') == path) {
                    return;
                }
                var fdata = new FormData();
//推荐还是最新
                var booktype = $("#booktype").text();
                fdata.append("type", booktype);

                var page_num = $("#page_num").text();
                fdata.append("page", page_num);

                fdata.append("show", 'picture');

                fdata.append("toggle", 'picture');

                xhr.open('POST', more_url, true);

                xhr.send(fdata);
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4) {
                        $("#picture").attr('src', path);
                        $("#list").attr('src', path2);
                        document.getElementById('down').innerHTML = '';
                        document.getElementById('down').innerHTML = this.responseText;
                    }
                }
            }
    );
</script>
</html>